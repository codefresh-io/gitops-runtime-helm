suite: Test External ArgoCD with GitOps Runtime
templates:
  - app-proxy/config.yaml
  - app-proxy/deployment.yaml
  - gitops-operator/*
  - event-reporters/**/*.yaml
  - argo-gateway/**
  - _components/gitops-operator/*
  - app-proxy/external-argocd-token.yaml
  - codefresh-cm.yaml
tests:
  - it: app-proxy ConfigMap should have valid ArgoCd URL
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/config.yaml
    asserts:
      - equal:
          path: data.argoCdUrl
          value: http://my-argocd-server

  - it: app-proxy ConfigMap should have valid default ArgoCd Username
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/config.yaml
    asserts:
      - equal:
          path: data.argoCdUsername
          value: admin

  - it: app-proxy ConfigMap should have valid ArgoCd Username with override
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/config.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                username: adminoverride
    asserts:
      - equal:
          path: data.argoCdUsername
          value: adminoverride

  - it: app-proxy ConfigMap override priority should prefer value from app-proxy.config (for backward compatibility)
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/config.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                username: external-adminoverride
      app-proxy:
        config:
          argoCdUsername: app-proxy-adminoverride
    asserts:
      - equal:
          path: data.argoCdUsername
          value: app-proxy-adminoverride

  - it: app-proxy ConfigMap should *not* have username, if auth.type is token
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/config.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: some-token
    asserts:
      - notExists:
          path: data.argoCdUsername

  - it: app-proxy ConfigMap should have isExternalArgoCD key set to true
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/config.yaml
    asserts:
      - equal:
          path: data.isExternalArgoCD
          value: "true"

  - it: app-proxy Deployment should have valid deafult ARGO_CD_USERNAME env var if auth.type is password
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_USERNAME
            valueFrom:
              configMapKeyRef:
                key: argoCdUsername
                name: cap-app-proxy-cm

  - it: app-proxy Deployment should have valid deafult ARGO_CD_PASSWORD env var set via passwordSecretKeyRef
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_PASSWORD
            valueFrom:
              secretKeyRef:
                key: password
                name: argocd-initial-admin-secret

  - it: app-proxy Deployment should have valid ARGO_CD_PASSWORD env var set via passwordSecretKeyRef override
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                passwordSecretKeyRef:
                  name: name-override
                  key: key-override
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_PASSWORD
            valueFrom:
              secretKeyRef:
                key: key-override
                name: name-override

  - it: app-proxy Deploymeny should have valid ARGO_CD_PASSWORD env var set via plaintext password
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                password: token
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_PASSWORD
            valueFrom:
              secretKeyRef:
                key: token
                name: gitops-runtime-argo-cd-password

  - it: app-proxy Deployment should *not* have ARGO_CD_TOKEN env var if auth.type is password
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    asserts:
      - notContains:
          any: true
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN

  - it: app-proxy Deployment should *not* have ARGO_CD_USERNAME env var if auth.type is token
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: plaintexttoken
    asserts:
      - notContains:
          any: true
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_USERNAME

  - it: app-proxy Deployment should *not* have ARGO_CD_PASSWORD env var if auth.type is token
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: plaintexttoken
    asserts:
      - notContains:
          any: true
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_PASSWORD

  - it: app-proxy Deployment should have valid ARGO_CD_TOKEN env var set via plaintext token
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: plaintexttoken
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN
            valueFrom:
              secretKeyRef:
                key: token
                name: gitops-runtime-argo-cd-token

  - it: app-proxy Deployment should have valid ARGO_CD_TOKEN env var set via tokenSecretKeyRef
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                tokenSecretKeyRef:
                  name: my-argocd-secret
                  key: my-token
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN
            valueFrom:
              secretKeyRef:
                name: my-argocd-secret
                key: my-token

  - it: gitops-operator Deployment should have valid ARGO_CD_TOKEN_SECRET_NAME env var set via tokenSecretKeyRef
    values:
      - ./values/mandatory-values.yaml
      - ./values/external-argocd-values.yaml
    template: gitops-operator/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                tokenSecretKeyRef:
                  name: my-argocd-secret
                  key: my-token
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: my-argocd-secret

  - it: gitops-operator Deployment should have valid ARGO_CD_TOKEN_SECRET_KEY env var set via tokenSecretKeyRef
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: gitops-operator/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                tokenSecretKeyRef:
                  name: my-argocd-secret
                  key: my-token
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: my-token

  - it: gitops-operator Deployment should have valid ARGO_CD_TOKEN_SECRET_NAME env var set via plaintext token
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: gitops-operator/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: "plaintexttoken"
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: gitops-runtime-argo-cd-token

  - it: gitops-operator Deployment should have valid ARGO_CD_TOKEN_SECRET_KEY env var set via plaintext token
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: gitops-operator/deployment.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: "plaintexttoken"
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: token

  - it: gitops-operator Deployment should have valid default ARGO_CD_TOKEN_SECRET_NAME env var
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: gitops-operator/deployment.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: argocd-token

  - it: gitops-operator Deployment should have valid default ARGO_CD_TOKEN_SECRET_KEY env var
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: gitops-operator/deployment.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: token

  - it: gitops-operator Deployment should have valid ARGO_CD_URL env var
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: gitops-operator/deployment.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_URL
            value: my-argocd-server:80

  - it: runtime-event-reporter ConfigMap should have valid ArgoCd URL
    template: event-reporters/runtime-event-reporter/configmap.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - equal:
          path: data["argocd.server"]
          value: my-argocd-server:80

  - it: runtime-event-reporter ConfigMap should have valid Redis URL
    template: event-reporters/runtime-event-reporter/configmap.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - equal:
          path: data["redis.server"]
          value: redis:6379

  - it: runtime-event-reporter ConfigMap should have valid Sources Server address
    template: event-reporters/runtime-event-reporter/configmap.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - equal:
          path: data["argo-gateway.server"]
          value: http://argo-gateway

  - it: runtime-event-reporter ConfigMap should have valid Repo Server URL
    template: event-reporters/runtime-event-reporter/configmap.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - equal:
          path: data["repo.server"]
          value: my-argocd-repo-server:8081

  - it: runtime-event-reporter Deployment should have valid default ARGO_CD_TOKEN_SECRET_NAME env var
    template: event-reporters/runtime-event-reporter/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: argocd-token

  - it: runtime-event-reporter Deployment should have valid default ARGO_CD_TOKEN_SECRET_KEY env var
    template: event-reporters/runtime-event-reporter/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: token

  - it: runtime-event-reporter Deployment should have valid ARGO_CD_TOKEN_SECRET_NAME env var set via tokenSecretKeyRef
    template: event-reporters/runtime-event-reporter/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                tokenSecretKeyRef:
                  name: my-argocd-token
                  key: my-token
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: my-argocd-token

  - it: runtime-event-reporter Deployment should have valid ARGO_CD_TOKEN_SECRET_KEY env var set via tokenSecretKeyRef
    template: event-reporters/runtime-event-reporter/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                tokenSecretKeyRef:
                  name: my-argocd-token
                  key: my-token
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: my-token

  - it: runtime-event-reporter Deployment should have valid ARGO_CD_TOKEN_SECRET_NAME env var set via plaintext token
    template: event-reporters/runtime-event-reporter/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: "plaintexttoken"
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: gitops-runtime-argo-cd-token

  - it: runtime-event-reporter Deployment should have valid ARGO_CD_TOKEN_SECRET_KEY env var set via plaintext token
    template: event-reporters/runtime-event-reporter/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: "plaintexttoken"
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: token

  - it: argo-gateway ConfigMap should have valid ArgoCd URL
    template: argo-gateway/configmap.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - equal:
          path: data["argocd.server"]
          value: my-argocd-server:80

  - it: argo-gateway ConfigMap should have valid Redis URL
    template: argo-gateway/configmap.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - equal:
          path: data["redis.server"]
          value: redis:6379

  - it: argo-gateway ConfigMap should have valid Repo Server URL
    template: argo-gateway/configmap.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - equal:
          path: data["repo.server"]
          value: my-argocd-repo-server:8081

  - it: argo-gateway Deployment should have valid default ARGO_CD_TOKEN_SECRET_NAME env var
    template: argo-gateway/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: argocd-token

  - it: argo-gateway Deployment should have valid default ARGO_CD_TOKEN_SECRET_KEY env var
    template: argo-gateway/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: token

  - it: argo-gateway Deployment should have valid ARGO_CD_TOKEN_SECRET_NAME env var set via tokenSecretKeyRef
    template: argo-gateway/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                tokenSecretKeyRef:
                  name: my-argocd-token
                  key: my-token
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: my-argocd-token

  - it: argo-gateway Deployment should have valid ARGO_CD_TOKEN_SECRET_KEY env var set via tokenSecretKeyRef
    template: argo-gateway/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                tokenSecretKeyRef:
                  name: my-argocd-token
                  key: my-token
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: my-token

  - it: argo-gateway Deployment should have valid ARGO_CD_TOKEN_SECRET_NAME env var set via plaintext token
    template: argo-gateway/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: "plaintexttoken"
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_NAME
            value: gitops-runtime-argo-cd-token

  - it: argo-gateway Deployment should have valid ARGO_CD_TOKEN_SECRET_KEY env var set via plaintext token
    template: argo-gateway/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: "plaintexttoken"
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_TOKEN_SECRET_KEY
            value: token

  - it: should require ArgoCd redis address if it's not provided
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        external-argo-cd:
          redis: null
    asserts:
      - failedTemplate:
          errorMessage: "ArgoCD is not enabled and .Values.global.external-argo-cd.redis is not set"

  - it: should require ArgoCd repoServer address if it's not provided
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        external-argo-cd:
          repoServer: null
    asserts:
      - failedTemplate:
          errorMessage: "ArgoCD is not enabled and .Values.global.external-argo-cd.repoServer is not set"

  - it: should required only allowed auth type for external ArgoCd
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: invalid
    asserts:
      - failedTemplate:
          errorMessage: "Invalid value for .Values.global.integrations.argo-cd.server.auth.type: invalid. Allowed values are: [password token]"

  - it: runtime-event-reporter Deployment should have valid ARGOCD_SERVER_ROOTPATH env var
    template: event-reporters/runtime-event-reporter/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        external-argo-cd:
          server:
            rootpath: /argocd
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGOCD_SERVER_ROOTPATH
            value: /argocd

  - it: argo-gateway Deployment should have valid ARGOCD_SERVER_ROOTPATH env var
    template: argo-gateway/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        external-argo-cd:
          server:
            rootpath: /argocd
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGOCD_SERVER_ROOTPATH
            value: /argocd

  - it: app-proxy ConfigMap should have valid ArgoCD url with rootpath suffix
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    template: app-proxy/config.yaml
    set:
      global:
        external-argo-cd:
          server:
            rootpath: /argocd
    asserts:
      - equal:
          path: data.argoCdUrl
          value: http://my-argocd-server/argocd

  - it: gitops-operator Deployment should have valid ARGO_CD_URL env var with rootpath suffix
    template: gitops-operator/deployment.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        external-argo-cd:
          server:
            rootpath: /argocd
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: ARGO_CD_URL
            value: my-argocd-server:80/argocd

  - it: gitops-runtime-argo-cd-token secret should be create when `auth.type=token` and `auth.token` are set
    template: app-proxy/external-argocd-token.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: mytoken
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: gitops-runtime-argo-cd-token
      - isNotNullOrEmpty:
          path: stringData.token

  - it: gitops-runtime-argo-cd-password secret should be create when `auth.type=password` and `auth.password` are set
    template: app-proxy/external-argocd-token.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: password
                password: mypassword
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: gitops-runtime-argo-cd-password
      - isNotNullOrEmpty:
          path: stringData.token

  - it: codefresh-cm ConfigMap should have runtime-event-reporter and sources-server
    template: codefresh-cm.yaml
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    asserts:
      - matchRegex:
          path: data.components
          pattern: "name: event-reporter"
      - matchRegex:
          path: data.components
          pattern: "name: argo-gateway"

  - it: should require ArgoCd token if auth.type=token is set and no token is provided
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        integrations:
          argo-cd:
            server:
              auth:
                type: token
                token: null
                tokenSecretKeyRef:
                  name: null
                  key: null
    asserts:
      - failedTemplate:
          errorMessage: ".Values.global.integrations.argo-cd.server.auth.type is set to 'token' therefore .Values.global.integrations.argo-cd.server.auth.tokenSecretKeyRef.name is required"

  - it: should require ArgoCd server address if it's not provided
    values:
      - ./values/mandatory-values-ingress.yaml
      - ./values/external-argocd-values.yaml
    set:
      global:
        external-argo-cd:
          server: null
    asserts:
      - failedTemplate:
          errorMessage: "ArgoCD is not enabled and .Values.global.external-argo-cd.server is not set"
